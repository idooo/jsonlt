(function(){function JSONLT(options){function isRule(input){return"string"!=typeof input?!1:-1===input.indexOf("#")?!1:!0}options=options||{},this.options=options,this.options.strict=options.strict||!1,this.transform=function(sourceObject,transformationObject){var self=this,result={};return Object.keys(transformationObject).forEach(function(key){"object"==typeof transformationObject[key]?result[key]=self.transform(sourceObject,transformationObject[key]):isRule(transformationObject[key])?result[key]=self.process(sourceObject,transformationObject[key]):"@jsonlt"!==key&&(result[key]=transformationObject[key])}),result},this.error=function(message){if(this.options.strict)throw new Error(message+" (JSON path: "+this.lastPath+")");return""},this.process=function(sourceObject,rulesString){var self=this,output=rulesString,rules=rulesString.match(RULE_REGEXP);return rules.forEach(function(rule){var rawRule=rule;rule=rule.trim();var arrayIndexMatch=rule.match(ARRAY_INDEX_RULE),castMatch=rule.match(CAST_NAME_RULE);castMatch&&(rule=rule.replace(castMatch[0],""));var filterMatch=rule.match(FILTER_RULE),mapMatch=rule.match(MAP_RULE),expandMatch=rule.match(EXPAND_RULE);expandMatch&&""===expandMatch[1]&&(expandMatch[1]=",");var match=rule.match(SIMPLE_RULE),path=match[1].replace(/#/,"").trim(),value=self.getByPath(sourceObject,path);arrayIndexMatch&&(value=self.getArrayIndex(value,arrayIndexMatch)),filterMatch&&(value=self.filter(value,filterMatch)),mapMatch&&(value=self.mapExpand(value,mapMatch)),expandMatch&&(value=self.expand(value,expandMatch)),castMatch&&(value=self.castToType(value,castMatch)),output=output.length===rawRule.length?value:output.replace(rawRule,value)}),output},this.getByPath=function(sourceObject,path){var _buffer,self=this,value=JSON.parse(JSON.stringify(sourceObject)),parts=path.split(".");for(self.lastPath=path;parts.length;)_buffer=parts.shift(),value="undefined"!=typeof value[_buffer]?value[_buffer]:self.error("Path '"+path+"' not found in object");return value},this.getArrayIndex=function(value,matchObject){if(!Array.isArray(value))return this.error("Value '"+value+"' is not an array");var index=parseInt(matchObject[1],10);return 0>index&&(index=value.length+index),"undefined"!=typeof value[index]?value[index]:this.error("Array out of bound, index: "+index)},this.castToType=function(value,matchObject){return"undefined"!=typeof value?"string"===matchObject[1]?value.toString():"number"===matchObject[1]?parseFloat(value):this.error("Casting to unknown type '"+matchObject[1]+"'. Available: string, number"):void 0},this.filter=function(value,matchObject){var key=matchObject[1],filterValue=matchObject[2].replace(/('|\\|")/g,"");return Array.isArray(value)?value.filter(function(item){return item[key]===filterValue}):this.error("Item is not an array '"+value+"'")},this.mapExpand=function(value,matchObject){return Array.isArray(value)?value.map(function(item){return item[matchObject[1]]}):this.error("Item is not an array '"+value+"'")},this.expand=function(value,matchObject){if("object"!=typeof value)return this.error("Item is not an object '"+value+"'");var delimiter=matchObject[1];delimiter=delimiter.replace(/\\s/g," ");var result=[];return Object.keys(value).forEach(function(fieldName){result.push(value[fieldName])}),result.join(delimiter)}}var RULE_REGEXP=/(#[\w\.\*\|=\(\)\[\]\-\d\^'\\]+)/g,SIMPLE_RULE=/([\w\.]+)/,ARRAY_INDEX_RULE=/\[([^\]]*)\]/,CAST_NAME_RULE=/\(([^\)]*)\)/,FILTER_RULE=/\|(\w+)=([\w']+)/,MAP_RULE=/\*(\w+)/,EXPAND_RULE=/\^(.*)/,root=this;"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=JSONLT),exports.JSONLT=JSONLT):root.JSONLT=JSONLT}).call(this);